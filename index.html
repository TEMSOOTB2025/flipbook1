<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Out of the Blue 2025 - Timothy Edwards Middle School</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/turn.js/3/turn.min.js"></script>
  <style>
    /* [All your existing CSS remains unchanged] */
  </style>
</head>
<body>
  <div id="loader">
    <img src="https://i.imgur.com/llF5iyg.gif" alt="Loading..." width="60">
    <p>Loading flipbook, please wait...</p>
  </div>

  <div id="main-layout">
    <!-- [Your existing layout structure remains unchanged] -->

    <div id="music-overlay" style="
      display: none;
      position: absolute;
      top: 30%;
      left: 75%;
      transform: translate(-50%, -50%);
      z-index: 20000;
      background: red;
      padding: 5px 10px;
      font-size: 11px;
      border-radius: 4px;
    ">
      <a href="https://drive.google.com/your-music-link" target="_blank" style="color: white; text-decoration: none;">Link to Music</a>
    </div>

    <div id="flipbook-display-area">
      <div id="flipbook-wrapper">
        <!-- [Your tooltip buttons and flipbook container remain unchanged] -->
      </div>
      <div id="page-scrollbar-container">
        <input type="range" id="page-scrollbar" min="1" max="158" value="1">
      </div>
    </div>
  </div>

  <script>
    const TOTAL_PAGES = 158;
    let loadedPages = {};

    function loadPage(pageNumber, callback) {
      if (loadedPages[pageNumber]) return callback();
      const img = new Image();
      img.src = `pages/Page_${pageNumber}.png`;
      img.onload = function () {
        $('#flipbook').turn('addPage', $('<div />', { class: 'page' }).append(img), pageNumber);
        loadedPages[pageNumber] = true;
        callback();
      };
    }

    function preloadFirstTenPages() {
      for (let i = 1; i <= 10; i++) {
        loadPage(i, () => {});
      }
    }

    $(document).ready(function () {
      $('#flipbook').turn({
        width: $('#flipbook-wrapper').width(),
        height: $('#flipbook-wrapper').height(),
        autoCenter: true,
        pages: TOTAL_PAGES,
        when: {
          turning: function (event, page, view) {
            if (page === 23) {
              try {
                $('#music-overlay').show();
              } catch (e) {
                console.error("Error showing music overlay:", e);
              }
            } else {
              $('#music-overlay').hide();
            }
          },
          turned: function (e, page) {
            $('#page-scrollbar').val(page);
          }
        }
      });

      preloadFirstTenPages();
      $('#flipbook').show();
      $('#loader').hide();
      $('#page-scrollbar-container').css({ display: 'block', visibility: 'visible' });

      $('#page-scrollbar').on('input', function () {
        const page = parseInt($(this).val());
        $('#flipbook').turn('page', page);
      });
    });
  </script>
</body>
</html>
